<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>Some Simple Examples for the Usage of the SimNPH Package</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>



<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Some Simple Examples for the Usage of the
SimNPH Package</h1>
<h3 class="subtitle">Generate Data, Test and Estimate, Summarise</h3>



<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(SimDesign)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(SimNPH)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(parallel)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>cl <span class="ot">&lt;-</span> <span class="fu">makeCluster</span>(<span class="dv">8</span>)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">clusterEvalQ</span>(cl, {</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(SimDesign)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(SimNPH)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(parallel)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<div id="a-simple-scenario-with-fixed-followup" class="section level1">
<h1>A simple scenario with fixed followup</h1>
<p>This is a simple example on how to run a simulation of analyses of
datasets with a delayed treatment effect using the max-combo and the
log-rank test. The</p>
<div id="setting-up-the-scenarios" class="section level2">
<h2>Setting up the Scenarios</h2>
<p>Setting up the simulations to be run. <code>createDesign</code>
creates a <code>tibble</code> with every combination of the parameters.
Each line corresponds to one simulation to be run.</p>
<p>The function <code>generate_delayed_effect</code> needs the columns:
<code>n_trt</code>: number of patients in the treatment arm,
<code>n_ctrl</code>: number of patients in the control arm,
<code>delay</code>: delay until onset of treatment effect,
<code>hazard_ctrl</code>: hazard under control and before onset of
treatment effect, <code>hazart_trt</code>: hazard under treatment,
<code>t_max</code>: maximum time of observation.</p>
<p>An example design <code>tibble</code> with all parameters filled out
can be created with <code>desing_skeleton_delayed_effect</code>. Use the
function to output an example function call that you can copy and modify
as needed, or assign the result to a variable to obtain a design
<code>tibble</code> with some default parameters.</p>
<p>By default this will create a simulation design skeleton for
simulations of 50 patients in each arm, a constant hazard of 0.2 under
control and a hazard of 0.02 under treatment after the effect onset
varying from 0 to 10.</p>
<!-- TODO set parameters to be somehow relevant (e.g. not 5mts delay and 200mts follow-up) -->
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>N_sim <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>Design <span class="ot">&lt;-</span> <span class="fu">desing_skeleton_delayed_effect</span>()</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; createDesign(</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   n_trt=50,               # 100 patients in the treatment arm</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   n_ctrl=50,              # 100 patients in the control arm</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   delay=seq(0, 10, by=2), # delay of 0, 1, ..., 10 days</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   hazard_ctrl=0.2,        # hazard under control and before treatment effect</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   hazard_trt=0.02         # hazard after onset of treatment effect</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; )</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>Design<span class="sc">$</span>followup <span class="ot">&lt;-</span> <span class="dv">200</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>Design<span class="sc">$</span>random_withdrawal <span class="ot">&lt;-</span> <span class="fl">0.01</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>Design<span class="sc">$</span>recruitment <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(Design)</span></code></pre></div>
<table style="width:100%;">
<colgroup>
<col width="7%" />
<col width="8%" />
<col width="7%" />
<col width="14%" />
<col width="13%" />
<col width="11%" />
<col width="22%" />
<col width="14%" />
</colgroup>
<thead>
<tr class="header">
<th align="right">n_trt</th>
<th align="right">n_ctrl</th>
<th align="right">delay</th>
<th align="right">hazard_ctrl</th>
<th align="right">hazard_trt</th>
<th align="right">followup</th>
<th align="right">random_withdrawal</th>
<th align="right">recruitment</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">50</td>
<td align="right">50</td>
<td align="right">0</td>
<td align="right">0.2</td>
<td align="right">0.02</td>
<td align="right">200</td>
<td align="right">0.01</td>
<td align="right">50</td>
</tr>
<tr class="even">
<td align="right">50</td>
<td align="right">50</td>
<td align="right">2</td>
<td align="right">0.2</td>
<td align="right">0.02</td>
<td align="right">200</td>
<td align="right">0.01</td>
<td align="right">50</td>
</tr>
<tr class="odd">
<td align="right">50</td>
<td align="right">50</td>
<td align="right">4</td>
<td align="right">0.2</td>
<td align="right">0.02</td>
<td align="right">200</td>
<td align="right">0.01</td>
<td align="right">50</td>
</tr>
<tr class="even">
<td align="right">50</td>
<td align="right">50</td>
<td align="right">6</td>
<td align="right">0.2</td>
<td align="right">0.02</td>
<td align="right">200</td>
<td align="right">0.01</td>
<td align="right">50</td>
</tr>
<tr class="odd">
<td align="right">50</td>
<td align="right">50</td>
<td align="right">8</td>
<td align="right">0.2</td>
<td align="right">0.02</td>
<td align="right">200</td>
<td align="right">0.01</td>
<td align="right">50</td>
</tr>
<tr class="even">
<td align="right">50</td>
<td align="right">50</td>
<td align="right">10</td>
<td align="right">0.2</td>
<td align="right">0.02</td>
<td align="right">200</td>
<td align="right">0.01</td>
<td align="right">50</td>
</tr>
</tbody>
</table>
</div>
<div id="defining-the-generate-funcion" class="section level2">
<h2>Defining the ‘Generate’ funcion</h2>
<p>Define the data generating ‘generate’ function, that beside
simulating the time to event also applies the different censoring
processes.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>my_generator <span class="ot">&lt;-</span> <span class="cf">function</span>(condition, <span class="at">fixed_objects=</span><span class="cn">NULL</span>){</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">generate_delayed_effect</span>(condition, fixed_objects) <span class="sc">|&gt;</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">recruitment_uniform</span>(condition<span class="sc">$</span>recruitment) <span class="sc">|&gt;</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">random_censoring_exp</span>(condition<span class="sc">$</span>random_withdrawal) <span class="sc">|&gt;</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">admin_censoring_time</span>(condition<span class="sc">$</span>followup)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>} </span></code></pre></div>
</div>
<div id="defining-the-summarise-function" class="section level2">
<h2>Defining the ‘Summarise’ function</h2>
<p>Next, we need to specify a summary function that computes the desired
operating characteristics for each simulation scenario, and each
analysis method. In the example below, we specify a summary function
that computes the power (as we consider scenarios under the alternative
in the example) of the log-rank test and the max-combo test across
simulated scenarios. For each scenario we just average the number of
times the computed p-value is below the significance level obtain the
power.</p>
<p>The results object contains the results of all replications of the
corresponding method for each row of the <code>Design</code> object. In
this example <code>results$p</code> contains all <code>N_sim</code>
p-values returned by the <code>analyse_maxcombo</code> or
<code>analyse_logrank</code> functions respectively. The Summary will
contain two columns <code>rejection.maxcombo</code> and
<code>rejection.logrank</code> with the empirical rejection rates of
both tests for each scenario.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>alpha <span class="ot">&lt;-</span> <span class="fl">0.05</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>Summarise <span class="ot">&lt;-</span> <span class="fu">create_summarise_function</span>(</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">maxcombo =</span> <span class="cf">function</span>(condition, results, <span class="at">fixed_objects=</span><span class="cn">NULL</span>){</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">data.frame</span>(<span class="st">&quot;rejection&quot;</span><span class="ot">=</span><span class="fu">mean</span>(results<span class="sc">$</span>p <span class="sc">&lt;</span> alpha))</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  },</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">logrank =</span> <span class="cf">function</span>(condition, results, <span class="at">fixed_objects=</span><span class="cn">NULL</span>){</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">data.frame</span>(<span class="st">&quot;rejection&quot;</span><span class="ot">=</span><span class="fu">mean</span>(results<span class="sc">$</span>p <span class="sc">&lt;</span> alpha))</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
</div>
<div id="putting-it-all-together" class="section level2">
<h2>Putting it all together</h2>
<p>Now we put it all together: in Design we give the scenarios defined
before. We want to run 100 replications for each scenario. We want to
generate data using the <code>generate_delayed_effect</code> function
using the parameters from <code>Design</code> and analyse each
replication of each scenario with the two functions
<code>analyse_logrank</code> and <code>analyse_maxcombo</code>. The
output should be summarised with the <code>Summarise</code> function
defined before and the simulations should be run in parallel.</p>
<p>Finally we select the interesting columns from the output. Since all
other parameters are the same for each scenario we just select delay and
the powers of the two tests.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">runSimulation</span>(</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  Design,</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">replications =</span> N_sim,</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">generate =</span> my_generator,</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">analyse =</span> <span class="fu">list</span>(</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">logrank  =</span> analyse_logrank,</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">maxcombo =</span> analyse_maxcombo</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">summarise =</span> Summarise,</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">cl =</span> cl,</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">save=</span><span class="cn">FALSE</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Number of parallel clusters in use: 8</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Simulation complete. Total execution time: 24.52s</span></span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>res <span class="sc">|&gt;</span> </span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(<span class="at">select=</span><span class="fu">c</span>(<span class="st">&quot;delay&quot;</span>, <span class="st">&quot;maxcombo.rejection&quot;</span>, <span class="st">&quot;logrank.rejection&quot;</span>)) <span class="sc">|&gt;</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="right">delay</th>
<th align="right">maxcombo.rejection</th>
<th align="right">logrank.rejection</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">0</td>
<td align="right">1.00</td>
<td align="right">1.00</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="right">1.00</td>
<td align="right">1.00</td>
</tr>
<tr class="odd">
<td align="right">4</td>
<td align="right">0.99</td>
<td align="right">0.89</td>
</tr>
<tr class="even">
<td align="right">6</td>
<td align="right">0.83</td>
<td align="right">0.43</td>
</tr>
<tr class="odd">
<td align="right">8</td>
<td align="right">0.51</td>
<td align="right">0.28</td>
</tr>
<tr class="even">
<td align="right">10</td>
<td align="right">0.14</td>
<td align="right">0.08</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="a-scenario-with-an-interim-analysis" class="section level1">
<h1>A scenario with an interim analysis</h1>
<p>In this scenario we extend the scenario from above to include a fixed
followup as well as an interim analysis after a fixed number of events.
For this we will define additional analyse functions.</p>
<p>First we extend the Design to include a column with the number of
events after which an interim analysis should be done.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>Design<span class="sc">$</span>interim_events <span class="ot">&lt;-</span> <span class="dv">25</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>Design<span class="sc">$</span>final_events <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(Design)</span></code></pre></div>
<table>
<colgroup>
<col width="5%" />
<col width="6%" />
<col width="5%" />
<col width="11%" />
<col width="10%" />
<col width="8%" />
<col width="16%" />
<col width="11%" />
<col width="13%" />
<col width="11%" />
</colgroup>
<thead>
<tr class="header">
<th align="right">n_trt</th>
<th align="right">n_ctrl</th>
<th align="right">delay</th>
<th align="right">hazard_ctrl</th>
<th align="right">hazard_trt</th>
<th align="right">followup</th>
<th align="right">random_withdrawal</th>
<th align="right">recruitment</th>
<th align="right">interim_events</th>
<th align="right">final_events</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">50</td>
<td align="right">50</td>
<td align="right">0</td>
<td align="right">0.2</td>
<td align="right">0.02</td>
<td align="right">200</td>
<td align="right">0.01</td>
<td align="right">50</td>
<td align="right">25</td>
<td align="right">50</td>
</tr>
<tr class="even">
<td align="right">50</td>
<td align="right">50</td>
<td align="right">2</td>
<td align="right">0.2</td>
<td align="right">0.02</td>
<td align="right">200</td>
<td align="right">0.01</td>
<td align="right">50</td>
<td align="right">25</td>
<td align="right">50</td>
</tr>
<tr class="odd">
<td align="right">50</td>
<td align="right">50</td>
<td align="right">4</td>
<td align="right">0.2</td>
<td align="right">0.02</td>
<td align="right">200</td>
<td align="right">0.01</td>
<td align="right">50</td>
<td align="right">25</td>
<td align="right">50</td>
</tr>
<tr class="even">
<td align="right">50</td>
<td align="right">50</td>
<td align="right">6</td>
<td align="right">0.2</td>
<td align="right">0.02</td>
<td align="right">200</td>
<td align="right">0.01</td>
<td align="right">50</td>
<td align="right">25</td>
<td align="right">50</td>
</tr>
<tr class="odd">
<td align="right">50</td>
<td align="right">50</td>
<td align="right">8</td>
<td align="right">0.2</td>
<td align="right">0.02</td>
<td align="right">200</td>
<td align="right">0.01</td>
<td align="right">50</td>
<td align="right">25</td>
<td align="right">50</td>
</tr>
<tr class="even">
<td align="right">50</td>
<td align="right">50</td>
<td align="right">10</td>
<td align="right">0.2</td>
<td align="right">0.02</td>
<td align="right">200</td>
<td align="right">0.01</td>
<td align="right">50</td>
<td align="right">25</td>
<td align="right">50</td>
</tr>
</tbody>
</table>
<div id="analyse-functions-with-an-interim-analysis" class="section level2">
<h2>‘Analyse’ functions with an interim analysis</h2>
<p>The <code>analyse_group_sequential</code> function allows to combine
two or more analyse functions to create an analysis function
corresponding to a group sequential design. The arguments are the times
or events after which the analyses are done, the nominal alpha at each
stage and the analyse functions to be used at each stage.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="do">## O&#39;Brien-Fleming Bounds for GSD with interim analysis at information time 1/2</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>nominal_alpha <span class="ot">&lt;-</span> ldbounds<span class="sc">::</span><span class="fu">ldBounds</span>(<span class="fu">c</span>(<span class="fl">0.5</span>,<span class="dv">1</span>))<span class="sc">$</span>nom.alpha</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="fu">clusterExport</span>(cl, <span class="st">&quot;nominal_alpha&quot;</span>)</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>Analyse <span class="ot">&lt;-</span>  <span class="fu">list</span>(</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">logrank_seq  =</span> <span class="fu">analyse_group_sequential</span>(</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">followup =</span> <span class="fu">c</span>(condition<span class="sc">$</span>interim_events, condition<span class="sc">$</span>final_events),</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">followup_type =</span> <span class="fu">c</span>(<span class="st">&quot;event&quot;</span>, <span class="st">&quot;event&quot;</span>),</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> nominal_alpha,</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">analyse_functions =</span> analyse_logrank</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">maxcombo_seq =</span> <span class="fu">analyse_group_sequential</span>(</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">followup =</span> <span class="fu">c</span>(condition<span class="sc">$</span>interim_events, condition<span class="sc">$</span>final_events),</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">followup_type =</span> <span class="fu">c</span>(<span class="st">&quot;event&quot;</span>, <span class="st">&quot;event&quot;</span>),</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> nominal_alpha,</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">analyse_functions =</span> analyse_maxcombo</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
</div>
<div id="a-summarise-function-for-the-more-complex-scenario" class="section level2">
<h2>A ‘Summarise’ function for the more complex scenario</h2>
<p>The output of the function created with
<code>analyse_group_sequential</code> contains additional columsn.
<code>rejected_at_stage</code> includes the stage at which the null was
first rejected or <code>Inf</code> if the null was not rejected,
<code>N_pat</code> and <code>N_evt</code> contain the number of patients
recruited and the number of events observed before the null was rejected
and <code>followup</code> contains the time after study start at which
the last analysis was done.</p>
<p>The results object also includes the results returned by each stage
in <code>results_stages</code>, but here we only use the overall
test-decision.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>Summarise <span class="ot">&lt;-</span> <span class="fu">create_summarise_function</span>(</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">maxcombo_seq =</span> <span class="fu">summarise_group_sequential</span>(),</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">logrank_seq =</span> <span class="fu">summarise_group_sequential</span>()</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
</div>
<div id="putting-it-all-together-1" class="section level2">
<h2>Putting it all together</h2>
<p>The call to <code>runSimulation</code> looks almost the same as above
but now the additional columns we defined in our <code>Summarise</code>
functions are included in the result.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">runSimulation</span>(</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  Design,</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">replications =</span> N_sim,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">generate =</span> my_generator,</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">analyse =</span> Analyse,</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">summarise =</span> Summarise,</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">cl =</span> cl,</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">save=</span><span class="cn">FALSE</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Number of parallel clusters in use: 8</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Simulation complete. Total execution time: 24.02s</span></span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>res <span class="sc">|&gt;</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(<span class="at">select=</span><span class="fu">c</span>(</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;delay&quot;</span>, </span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;maxcombo_seq.rejection&quot;</span>, <span class="st">&quot;logrank_seq.rejection&quot;</span>,</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;maxcombo_seq.n_pat&quot;</span>, <span class="st">&quot;logrank_seq.n_pat&quot;</span>,</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;maxcombo_seq.n_evt&quot;</span>, <span class="st">&quot;logrank_seq.n_evt&quot;</span>,</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;maxcombo_seq.followup&quot;</span>, <span class="st">&quot;logrank_seq.followup&quot;</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    )) <span class="sc">|&gt;</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>()</span></code></pre></div>
<table>
<colgroup>
<col width="3%" />
<col width="13%" />
<col width="13%" />
<col width="11%" />
<col width="10%" />
<col width="11%" />
<col width="10%" />
<col width="13%" />
<col width="12%" />
</colgroup>
<thead>
<tr class="header">
<th align="right">delay</th>
<th align="right">maxcombo_seq.rejection</th>
<th align="right">logrank_seq.rejection</th>
<th align="right">maxcombo_seq.n_pat</th>
<th align="right">logrank_seq.n_pat</th>
<th align="right">maxcombo_seq.n_evt</th>
<th align="right">logrank_seq.n_evt</th>
<th align="right">maxcombo_seq.followup</th>
<th align="right">logrank_seq.followup</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">0</td>
<td align="right">1.00</td>
<td align="right">1.00</td>
<td align="right">52.07</td>
<td align="right">51.70</td>
<td align="right">25.25</td>
<td align="right">25.00</td>
<td align="right">25.88373</td>
<td align="right">25.72497</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="right">1.00</td>
<td align="right">0.92</td>
<td align="right">58.03</td>
<td align="right">69.42</td>
<td align="right">35.25</td>
<td align="right">43.75</td>
<td align="right">29.07689</td>
<td align="right">34.37619</td>
</tr>
<tr class="odd">
<td align="right">4</td>
<td align="right">0.86</td>
<td align="right">0.41</td>
<td align="right">69.52</td>
<td align="right">70.75</td>
<td align="right">48.75</td>
<td align="right">49.75</td>
<td align="right">34.17083</td>
<td align="right">34.74944</td>
</tr>
<tr class="even">
<td align="right">6</td>
<td align="right">0.35</td>
<td align="right">0.19</td>
<td align="right">67.67</td>
<td align="right">68.09</td>
<td align="right">49.50</td>
<td align="right">49.75</td>
<td align="right">33.19477</td>
<td align="right">33.43826</td>
</tr>
<tr class="odd">
<td align="right">8</td>
<td align="right">0.13</td>
<td align="right">0.07</td>
<td align="right">65.61</td>
<td align="right">66.15</td>
<td align="right">49.50</td>
<td align="right">50.00</td>
<td align="right">32.38081</td>
<td align="right">32.68296</td>
</tr>
<tr class="even">
<td align="right">10</td>
<td align="right">0.10</td>
<td align="right">0.06</td>
<td align="right">64.25</td>
<td align="right">64.17</td>
<td align="right">49.75</td>
<td align="right">49.75</td>
<td align="right">31.92524</td>
<td align="right">31.95563</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="estimation" class="section level1">
<h1>Estimation</h1>
<div id="calculating-the-true-values-of-the-summary-statistics" class="section level2">
<h2>Calculating the true values of the summary statistics</h2>
<p>To evaluate the performance of an estimator, we first compute the
values of some true summary statistics to which the estimates will be
compared. The most relevant true summary statistics can be computed by a
convenience function for each scenario. Just pipe the Design data.frame
to the function and the values of the statistics are added as
columns.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>Design <span class="ot">&lt;-</span> Design <span class="sc">|&gt;</span> </span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">true_summary_statistics_delayed_effect</span>()</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(Design)</span></code></pre></div>
<table>
<colgroup>
<col width="3%" />
<col width="3%" />
<col width="3%" />
<col width="6%" />
<col width="5%" />
<col width="4%" />
<col width="9%" />
<col width="6%" />
<col width="7%" />
<col width="6%" />
<col width="4%" />
<col width="10%" />
<col width="5%" />
<col width="11%" />
<col width="5%" />
<col width="5%" />
</colgroup>
<thead>
<tr class="header">
<th align="right">n_trt</th>
<th align="right">n_ctrl</th>
<th align="right">delay</th>
<th align="right">hazard_ctrl</th>
<th align="right">hazard_trt</th>
<th align="right">followup</th>
<th align="right">random_withdrawal</th>
<th align="right">recruitment</th>
<th align="right">interim_events</th>
<th align="right">final_events</th>
<th align="right">rmst_trt</th>
<th align="right">median_survival_trt</th>
<th align="right">rmst_ctrl</th>
<th align="right">median_survival_ctrl</th>
<th align="right">gAHR</th>
<th align="right">AHR</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">50</td>
<td align="right">50</td>
<td align="right">0</td>
<td align="right">0.2</td>
<td align="right">0.02</td>
<td align="right">200</td>
<td align="right">0.01</td>
<td align="right">50</td>
<td align="right">25</td>
<td align="right">50</td>
<td align="right">9.063462</td>
<td align="right">34.657361</td>
<td align="right">4.323324</td>
<td align="right">3.465736</td>
<td align="right">0.2999391</td>
<td align="right">0.1000000</td>
</tr>
<tr class="even">
<td align="right">50</td>
<td align="right">50</td>
<td align="right">2</td>
<td align="right">0.2</td>
<td align="right">0.02</td>
<td align="right">200</td>
<td align="right">0.01</td>
<td align="right">50</td>
<td align="right">25</td>
<td align="right">50</td>
<td align="right">6.603949</td>
<td align="right">16.657359</td>
<td align="right">4.323324</td>
<td align="right">3.465736</td>
<td align="right">0.4818947</td>
<td align="right">0.4274490</td>
</tr>
<tr class="odd">
<td align="right">50</td>
<td align="right">50</td>
<td align="right">4</td>
<td align="right">0.2</td>
<td align="right">0.02</td>
<td align="right">200</td>
<td align="right">0.01</td>
<td align="right">50</td>
<td align="right">25</td>
<td align="right">50</td>
<td align="right">5.293852</td>
<td align="right">3.465736</td>
<td align="right">4.323324</td>
<td align="right">3.465736</td>
<td align="right">0.6570514</td>
<td align="right">0.6617127</td>
</tr>
<tr class="even">
<td align="right">50</td>
<td align="right">50</td>
<td align="right">6</td>
<td align="right">0.2</td>
<td align="right">0.02</td>
<td align="right">200</td>
<td align="right">0.01</td>
<td align="right">50</td>
<td align="right">25</td>
<td align="right">50</td>
<td align="right">4.651875</td>
<td align="right">3.465737</td>
<td align="right">4.323324</td>
<td align="right">3.465736</td>
<td align="right">0.8044382</td>
<td align="right">0.8223728</td>
</tr>
<tr class="odd">
<td align="right">50</td>
<td align="right">50</td>
<td align="right">8</td>
<td align="right">0.2</td>
<td align="right">0.02</td>
<td align="right">200</td>
<td align="right">0.01</td>
<td align="right">50</td>
<td align="right">25</td>
<td align="right">50</td>
<td align="right">4.386342</td>
<td align="right">3.465739</td>
<td align="right">4.323324</td>
<td align="right">3.465736</td>
<td align="right">0.9178277</td>
<td align="right">0.9296242</td>
</tr>
<tr class="even">
<td align="right">50</td>
<td align="right">50</td>
<td align="right">10</td>
<td align="right">0.2</td>
<td align="right">0.02</td>
<td align="right">200</td>
<td align="right">0.01</td>
<td align="right">50</td>
<td align="right">25</td>
<td align="right">50</td>
<td align="right">4.323324</td>
<td align="right">3.465747</td>
<td align="right">4.323324</td>
<td align="right">3.465736</td>
<td align="right">1.0000000</td>
<td align="right">1.0000000</td>
</tr>
</tbody>
</table>
</div>
<div id="defining-the-summarise-function-1" class="section level2">
<h2>Defining the <code>Summarise</code> function</h2>
<p>In the Summarise function the true value against which the estimator
should be compared has to be specified. If coverage and average width of
the confidence intervalls should be estimated, the CI bounds should also
be specified.</p>
<p>The arguments to the functions are left unevaluated and are later
evaluated in the <code>results</code> and <code>condition</code>
datasets respectively. So any expressions using variables from results
can be used for the estimated value and the CI bounds and expressions
using variables from condition can be used in the argument for the real
value.</p>
<p>In this case we want to compare the hazard ratio estimated by the cox
model to the geometric average hazard ratio (the summary statistic the
Cox model acutally computes under non proportional hazards) as well as
to the hazard ratio after onset of treatment, calculated from the two
respective columns of the Design data.frame.</p>
<p>Note that one name can be used twice to summarise the output of one
analysis method two times, like in this case, comparing it to two
different summary statistics.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>Summarise <span class="ot">&lt;-</span> <span class="fu">create_summarise_function</span>(</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">coxph=</span><span class="fu">summarise_estimator</span>(hr, gAHR, hr_lower, hr_upper, <span class="at">name=</span><span class="st">&quot;gAHR&quot;</span>),</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">coxph=</span><span class="fu">summarise_estimator</span>(hr, hazard_trt<span class="sc">/</span>hazard_ctrl, hr_lower, hr_upper, <span class="at">name=</span><span class="st">&quot;HR&quot;</span>)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
</div>
<div id="putting-it-all-together-2" class="section level2">
<h2>Putting it all together</h2>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>Analyse <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">coxph =</span> analyse_coxph</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">runSimulation</span>(</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  Design,</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">replications =</span> N_sim,</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">generate =</span> my_generator,</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">analyse =</span> Analyse,</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">summarise =</span> Summarise,</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">cl =</span> cl,</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">save=</span><span class="cn">FALSE</span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Number of parallel clusters in use: 8</span></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Simulation complete. Total execution time: 13.92s</span></span></code></pre></div>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>res <span class="sc">|&gt;</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(<span class="at">select=</span><span class="fu">c</span>(</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;delay&quot;</span>, <span class="st">&quot;coxph.HR.bias&quot;</span>, <span class="st">&quot;coxph.gAHR.bias&quot;</span>, <span class="st">&quot;coxph.HR.mse&quot;</span>, </span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;coxph.gAHR.mse&quot;</span>, <span class="st">&quot;coxph.HR.coverage&quot;</span>, <span class="st">&quot;coxph.gAHR.coverage&quot;</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">|&gt;</span> </span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>()</span></code></pre></div>
<table>
<colgroup>
<col width="5%" />
<col width="13%" />
<col width="15%" />
<col width="12%" />
<col width="14%" />
<col width="17%" />
<col width="19%" />
</colgroup>
<thead>
<tr class="header">
<th align="right">delay</th>
<th align="right">coxph.HR.bias</th>
<th align="right">coxph.gAHR.bias</th>
<th align="right">coxph.HR.mse</th>
<th align="right">coxph.gAHR.mse</th>
<th align="right">coxph.HR.coverage</th>
<th align="right">coxph.gAHR.coverage</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">0</td>
<td align="right">0.0026441</td>
<td align="right">-0.1972950</td>
<td align="right">0.0011789</td>
<td align="right">0.0400972</td>
<td align="right">0.94</td>
<td align="right">0.06</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="right">0.2139303</td>
<td align="right">-0.1679644</td>
<td align="right">0.0508667</td>
<td align="right">0.0333126</td>
<td align="right">0.00</td>
<td align="right">0.58</td>
</tr>
<tr class="odd">
<td align="right">4</td>
<td align="right">0.4289639</td>
<td align="right">-0.1280876</td>
<td align="right">0.1990636</td>
<td align="right">0.0314600</td>
<td align="right">0.00</td>
<td align="right">0.86</td>
</tr>
<tr class="even">
<td align="right">6</td>
<td align="right">0.5915259</td>
<td align="right">-0.1129123</td>
<td align="right">0.3730380</td>
<td align="right">0.0358843</td>
<td align="right">0.00</td>
<td align="right">0.90</td>
</tr>
<tr class="odd">
<td align="right">8</td>
<td align="right">0.7101261</td>
<td align="right">-0.1077016</td>
<td align="right">0.5336694</td>
<td align="right">0.0409900</td>
<td align="right">0.00</td>
<td align="right">0.93</td>
</tr>
<tr class="even">
<td align="right">10</td>
<td align="right">0.7933801</td>
<td align="right">-0.1066199</td>
<td align="right">0.6578947</td>
<td align="right">0.0398106</td>
<td align="right">0.00</td>
<td align="right">0.93</td>
</tr>
</tbody>
</table>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
